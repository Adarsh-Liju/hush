<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>WebSSH Terminal</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
        
        <style>
            .terminal-output {
                font-family: 'Courier New', monospace;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            
            .terminal-input {
                font-family: 'Courier New', monospace;
                background: transparent;
                border: none;
                outline: none;
                color: #10b981;
            }
            
            .cursor-blink {
                animation: blink 1s infinite;
            }
            
            @keyframes blink {
                0%, 50% { opacity: 1; }
                51%, 100% { opacity: 0; }
            }
        </style>
    </head>
    <body class="bg-black text-green-400 font-mono h-screen flex flex-col">
        <!-- Header -->
        <div class="bg-gray-900 border-b border-green-500 p-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold text-white">WebSSH Terminal</h1>
                    <p class="text-sm text-gray-400">
                        Connected to <span class="text-green-400 font-bold">{{.Host}}</span>:<span class="text-green-400 font-bold">{{.Port}}</span> 
                        as <span class="text-green-400 font-bold">{{.User}}</span>
                    </p>
                </div>
                <div class="flex space-x-2">
                    <button 
                        onclick="clearTerminal()" 
                        class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm"
                    >
                        Clear
                    </button>
                    <button 
                        onclick="window.location.href='/'"
                        class="px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm"
                    >
                        Disconnect
                    </button>
                </div>
            </div>
        </div>

        <!-- Terminal Container -->
        <div class="flex-1 flex flex-col p-4 space-y-4">
            <!-- Terminal Output -->
            <div 
                id="terminal"
                class="flex-1 bg-gray-900 border border-green-500 rounded p-4 overflow-y-auto terminal-output text-green-300"
                style="min-height: 400px;"
            >
                <div class="text-green-400">
                    Welcome to WebSSH Terminal<br>
                    Connected to {{.Host}}:{{.Port}} as {{.User}}<br>
                    Type your commands below...<br><br>
                </div>
            </div>

            <!-- Input Area -->
            <div class="flex space-x-2">
                <div class="flex-1 bg-gray-900 border border-green-500 rounded p-3 flex items-center">
                    <span class="text-green-400 mr-2">$</span>
                    <input
                        id="cmd"
                        type="text"
                        autocomplete="off"
                        placeholder="Type a command..."
                        class="flex-1 terminal-input text-green-300 placeholder-gray-500"
                        onkeydown="handleKeyDown(event)"
                    />
                    <span id="cursor" class="text-green-400 cursor-blink">|</span>
                </div>
                <button
                    onclick="sendCommand()"
                    class="px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded font-bold transition-colors"
                >
                    Send
                </button>
            </div>

            <!-- Status Bar -->
            <div class="flex justify-between items-center text-sm text-gray-500">
                <div>
                    <span id="status" class="text-green-400">● Connected</span>
                </div>
                <div>
                    <span id="connection-info">WebSocket: Ready</span>
                </div>
            </div>
        </div>

        <script>
            const ws = new WebSocket("ws://" + location.host + "/ws");
            const term = document.getElementById("terminal");
            const input = document.getElementById("cmd");
            const cursor = document.getElementById("cursor");
            const status = document.getElementById("status");
            const connectionInfo = document.getElementById("connection-info");

            // WebSocket event handlers
            ws.onopen = function() {
                status.textContent = "● Connected";
                status.className = "text-green-400";
                connectionInfo.textContent = "WebSocket: Connected";
                input.focus();
            };

            ws.onmessage = function(e) {
                appendToTerminal(e.data);
            };

            ws.onclose = function() {
                status.textContent = "● Disconnected";
                status.className = "text-red-400";
                connectionInfo.textContent = "WebSocket: Closed";
                appendToTerminal("\n\nConnection closed.\n");
            };

            ws.onerror = function() {
                status.textContent = "● Error";
                status.className = "text-red-400";
                connectionInfo.textContent = "WebSocket: Error";
                appendToTerminal("\n\nConnection error occurred.\n");
            };

            // Terminal functions
            function appendToTerminal(text) {
                term.innerHTML += text;
                term.scrollTop = term.scrollHeight;
            }

            function sendCommand() {
                const val = input.value.trim();
                if (val !== "" && ws.readyState === WebSocket.OPEN) {
                    ws.send(val + "\n");
                    appendToTerminal("$ " + val + "\n");
                    input.value = "";
                }
            }

            function handleKeyDown(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    sendCommand();
                }
            }

            function clearTerminal() {
                term.innerHTML = '<div class="text-green-400">Terminal cleared.<br><br></div>';
            }

            // Auto-focus input on page load
            window.onload = function() {
                input.focus();
            };

            // Handle page visibility change
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    input.focus();
                }
            });

            // Handle window focus
            window.addEventListener('focus', function() {
                input.focus();
            });
        </script>
    </body>
</html>